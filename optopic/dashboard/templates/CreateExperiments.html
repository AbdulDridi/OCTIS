<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>OpTopic - Create Experiments</title>
    <link href="{{ url_for('static', filename='styles/bootstrap.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles/styles.css') }}" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}">
</head>

<body>
    <script>
        function destroy() {
            li = this.parentElement
            li.parentElement.removeChild(li);
        }
        function newListElement(listToUpdate, identifier, content) {
            if (listToUpdate == "optimizeMetrics") {
                content.type = "optimize";
                lastChild = document.getElementById(listToUpdate).lastChild;
                if (lastChild.tagName == "LI" || lastChild.tagName == "li") lastChild.remove()
            } else {
                content.type = "track";
            }
            content = JSON.stringify(content);

            var li = document.createElement("li");
            li.classList.add("media")

            var t = document.createElement("div")
            t.classList.add("media-body")
            t.innerHTML = "<b>" + identifier + "</b> " + content

            var data = document.createElement("input")

            data.setAttribute("type", "hidden");
            data.setAttribute("name", "metric." + identifier)
            data.setAttribute("value", content);


            document.getElementById(listToUpdate).appendChild(li);

            var span = document.createElement("SPAN");
            var txt = document.createTextNode("\u00D7");
            span.className = "close";
            span.appendChild(txt);


            li.appendChild(t);
            li.appendChild(data);
            li.appendChild(span);

            span.addEventListener("click", destroy)

        }

    </script>

    <div>
        <ul class="navbar">
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('home') }}"><img style="width:20%"
                        src="{{ url_for('static', filename='images/logo.png') }}" alt="alternative"></a>
            </li>
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('home') }}">HOME</a>
            </li>
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('CreateExperiments') }}">CREATE EXPERIMENTS</a>
            </li>
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('VisualizeExperiments') }}">VISUALIZE
                    EXPERIMENTS</a>
            </li>
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('ManageExperiments') }}">MANAGE EXPERIMENTS</a>
            </li>
            <li class="navbarEl">
                <a class="navbarLink" href="{{ url_for('serverClosed') }}">CLOSE DASHBOARD</a>
            </li>
        </ul>
    </div>

    <header id="header">
        <div>
            </br>
            <h1 style="text-align: center">Experiment creation
                <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample"
                    aria-expanded="false" aria-controls="collapseExample">
                    Click here to read the instructions!
                </button>
            </h1>
        </div>
    </header>
    <hr>
    <div class="outContainer">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-container">
                        <div class="collapse" id="collapseExample">
                            <div class="card card-body">
                                <p class="lead"> In this page, you can define and start the optimization experiments.
                                    An optimization experiment is an experiment that involves a chosen
                                    dataset and topic modeling algorithm whose hyperparameters (or a subset
                                    of hyperparameters) are optimized with respect of a chosen evaluation metric.
                                </p>

                                </br>
                                <h5> Quick start: </h5>

                                <ul>
                                    <li> Select the folder in which you will save your experiments.
                                        For each experiment you need to specify the name of the experiment (experiment
                                        name)
                                        and the name for the set of experiments (batch name). The batch name will be the
                                        parent
                                        folder for all the experiments you will start.
                                    </li>
                                    <li> Select a <strong>Dataset</strong> among our preprocessed datasets.
                                    </li>
                                    <li>
                                        Select a <strong>Model</strong> among our predefined topic models.
                                    </li>
                                    <li>
                                        Select the <strong>hyperparameters</strong> of the model that you want to
                                        optimize
                                        and/or fix the value of the hyperpararameters that you like.
                                        If you optimize a hyperparameter, you need to select the <strong>value
                                            range</strong>
                                        for the selected hyperparameter.
                                    </li>
                                    <li>
                                        Select the <strong>Metric</strong> that you want to optimize (just one for now,
                                        but we
                                        plan to do multi-objective hyperparameter optimization soon) and its
                                        corresponding
                                        parameters.
                                    </li>
                                    <li>
                                        Select the configuration of the <strong>parameters of Bayesian
                                            Optimization</strong>.
                                    </li>
                                </ul>

                            </div>
                        </div>

                        <div class="customFormSection">
                            <form id="experimentForm" data-focus="false" method="post"
                                action="{{ url_for('startExperiment') }}">
                                <div>
                                    <label>select a path to save the experiment</label>
                                    <input type="text" class="coolInput" id="path" name="path" required>
                                </div>
                                <div class="row">
                                    <div class="col-6" data-toggle="popover" title="Popover title 3"
                                         data-content="And here's some amazing content. It's very engaging. Right?">
                                        <label>Id of the batch</label>
                                        <input type="text" class="coolInput" id="batchId" name="batchId" required>
                                    </div>
                                    <div class="col-6">
                                        <label>Id of the experiment</label>
                                        <input type="text" class="coolInput" id="expId" name="expId" required>
                                    </div>
                                </div>
                                </br>
                                <div class="customContainer">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <h2>Choose a Dataset</h2>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div id="datasetSelector" class="col-lg-12"></div>
                                        </div>
                                    </div>
                                </div>
                                </br>
                                <div class="customContainer">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <h2>Choose Model</h2>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div id="modelForm" class="col-lg-12">
                                            </div>
                                            <div id="modelParameters" class="col-lg-12">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="services" class="metricBlock">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="metric-name">Metrics</div>
                                                <h2>Choose Metric to optimize</h2>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12" id="optimizeMetrics">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="Metrics">
                                    <ul class="list-unstyled li-space-lg" id="metricsList">
                                    </ul>
                                </div>
                                <div id="services-2" class="metricBlock">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="metric-name"></div>
                                                <h2>Choose Metrics to track</h2>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12" id="trackMetrics">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="trackMetrics">
                                    <ul class="list-unstyled li-space-lg" id="trackmetricsList">
                                    </ul>
                                </div>
                                <div class="customContainer">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <h2>Optimization parameters</h2>
                                            </div>
                                        </div>
                                        <div id="boSelector" class="col-lg-12">
                                            <div id="boRow" class="row col-lg-12">
                                                <div class="col-lg-2">
                                                    <p><b>Number of iterations</b></p>
                                                    <input type="number" class="coolInput" value="5" id="iterations"
                                                        name="iterations" required>
                                                </div>
                                                <div class="col-lg-2">
                                                    <p><b>Model runs</b></p>
                                                    <input type="number" class="coolInput" value="3" id="runs"
                                                        name="runs" required>
                                                </div>
                                                <div class="col-lg-2">
                                                    <p><b>Initial random points</b></p>
                                                    <input type="number" class="coolInput" value="3"
                                                        id="n_random_starts" name="n_random_starts" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button type="submit" class="send-button">Start Experiment</button>
                                </div>
                                <div class="form-message">
                                    <div id="pmsgSubmit" class="h3 text-center hidden"></div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <h4>OpTopic</h4>
            <p class="white">Optimizing topic models made simple.</p>
        </div>
    </div>

    <script type="text/javascript" src="{{ url_for('static', filename='jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='popper.min.js') }}"></script>
    <script>
        function getParams(vars) {
            return vars;
        }

        $(function () {
            $('[data-toggle="popover"]').popover()
        });

        $(document).ready(function () {
            //Get dataset names
            dataset = getParams({{ datasets| tojson}});
            imgPath = "{{ url_for('static', filename='images/dataset.png') }}";
            rBtnName = "dataset"
            father = document.getElementById("datasetSelector");
            createCoolSelection(dataset, imgPath, rBtnName, father)


            model = getParams({{ models| tojson}});
            father = document.getElementById("modelForm");

            modelNames = []
            for (const [key, value] of Object.entries(model)) {
                modelNames.push(key)
        }
        rBtnName = "model"
        imgPath = "{{ url_for('static', filename='images/model.png') }}";
        createCoolSelection(modelNames, imgPath, rBtnName, father)

        metrics = getParams({{ metrics| tojson}});

        for (const [key, value] of Object.entries(metrics)) {
            addMetricBox(key, value, "optimizeMetrics")
            addMetricBox(key, value, "trackMetrics")
        }


        BO = getParams({{ optimization| tojson}});

        boSelector = document.getElementById("boSelector");

        surrogateModelInput = document.createElement("select")
        surrogateModelInput.classList.add("coolSelect")
        surrogateModelInput.name = "surrogateModel"

        for (const val of BO["surrogate_models"]) {
            var option = document.createElement("option");
            option.text = val["name"];
            option.value = val["id"]
            surrogateModelInput.appendChild(option)
        }


        div = document.getElementById("boRow");
        //div = document.createElement("div")
        //div.classList.add("form-group")
        //div.classList.add("col-lg-1")

        new_div = document.createElement("div")
        new_div.classList.add("form-group")
        new_div.classList.add("col-lg-3")


        label = document.createElement("p")
        label.innerHTML = "<b>Surrogate model</b>";

        new_div.appendChild(label)
        new_div.appendChild(surrogateModelInput)

        div.appendChild(new_div)

        boSelector.appendChild(div)


        AcqFuncInput = document.createElement("select")
        AcqFuncInput.classList.add("coolSelect")
        AcqFuncInput.name = "acquisitionFunction"

        for (const val of BO["acquisition_functions"]) {
            var option = document.createElement("option");
            option.text = val["name"];
            option.value = val["id"]
            AcqFuncInput.appendChild(option)
        }

        label = document.createElement("p")
        label.innerHTML = "<b>Acquisition function</b>";

        div = document.getElementById("boRow");
        new_div = document.createElement("div")
        new_div.classList.add("form-group")
        new_div.classList.add("col-lg-3")

        new_div.appendChild(label)
        new_div.appendChild(AcqFuncInput)

        div.appendChild(new_div)

        boSelector.appendChild(div)


        function addMetricBox(name, info, where) {

            fat = document.getElementById(where)

            box = document.createElement("div")
            box.classList.add("singleMetric")
            fat.appendChild(box)

            box_body = document.createElement("div")
            box_body.classList.add("singleMetricBody")
            box.appendChild(box_body)

            box_title = document.createElement("h3")
            box_title.innerHTML = info["name"]
            box_title.id = name
            box_body.appendChild(box_title)

            for (const [key, value] of Object.entries(info)) {
                if (key != "name") {

                    switch (value["type"]) {

                        case "Categorical":
                            newInput = document.createElement("select")
                            newInput.classList.add("coolSelect")
                            newInput.id = key + "input"

                            for (const val of value["possible_values"]) {
                                var option = document.createElement("option");
                                option.text = val;
                                newInput.appendChild(option)
                            }

                            label = document.createElement("p")
                            label.innerHTML = key;

                            information = document.createElement("div")
                            information.classList.add("information")
                            information.appendChild(label)
                            information.appendChild(newInput)
                            box_body.appendChild(information)
                            updateDropdownIndex(newInput.id, value["default_value"]);

                            break;
                        case "Real":
                            newInput = document.createElement("input")
                            newInput.setAttribute("type", "number");
                            if ("step" in value) {
                                newInput.setAttribute("step", value["step"]);
                            } else {
                                newInput.setAttribute("step", "any");
                            }
                            newInput.defaultValue = value["default_value"];

                            var label = document.createElement("p");
                            label.innerHTML = key;

                            information = document.createElement("div")
                            information.classList.add("information")
                            information.appendChild(label)
                            information.appendChild(newInput)
                            box_body.appendChild(information)


                            break;
                        case "Integer":
                            newInput = document.createElement("input")
                            newInput.setAttribute("type", "number");
                            if ("step" in value) {
                                newInput.setAttribute("step", value["step"]);
                            }
                            newInput.defaultValue = value["default_value"];

                            var label = document.createElement("p");
                            label.innerHTML = key;

                            information = document.createElement("div")
                            information.classList.add("information")
                            information.appendChild(label)
                            information.appendChild(newInput)
                            box_body.appendChild(information)
                            break;

                        case "String":
                            newInput = document.createElement("input")
                            newInput.setAttribute("type", "text");
                            newInput.defaultValue = value["default_value"];

                            var label = document.createElement("p");
                            label.innerHTML = key;

                            information = document.createElement("div")
                            information.classList.add("information")
                            information.appendChild(label)
                            information.appendChild(newInput)
                            box_body.appendChild(information)
                            break;

                    }


                }
            }

            button_container = document.createElement("div")
            button_container.classList.add("button-container")
            box.appendChild(button_container)

            button = document.createElement("div")
            button.classList.add("coolButton")
            button.classList.add("metricButton")
            button.classList.add("page-scroll")
            button.innerHTML = "ADD"

            button.addEventListener("click", function () {

                thebox = this.parentElement.parentElement

                content = {}
                name = ""


                for (var i = 0; i < thebox.childNodes.length; i++) {
                    if (thebox.childNodes[i].className == "singleMetricBody") {
                        TheBody = thebox.childNodes[i];

                        for (var j = 0; j < TheBody.childNodes.length; j++) {
                            if (TheBody.childNodes[j].className == "information") {
                                theDiv = TheBody.childNodes[j];

                                if (theDiv.childNodes[0].nodeName == "P") {
                                    content[theDiv.childNodes[0].innerHTML] = theDiv.childNodes[1].value
                                } else {
                                    content[theDiv.childNodes[1].innerHTML] = theDiv.childNodes[0].value
                                }
                            } else {
                                content.metric = TheBody.childNodes[j].innerHTML
                                name = TheBody.childNodes[j].id
                            }
                        }
                        break;
                    }
                }

                //newListElement(where, name, JSON.stringify(content))
                newListElement(where, name, content)

            })

            button_container.appendChild(button)
        }

        function createCoolSelection(data, imagePath, rBtnName, father) {

            var model = document.createElement("div")
            model.style.display = "none";
            model.id = "selected_model"
            model.innerHTML = ""

            father.appendChild(model)

            dataLength = data.length;
            for (i = 0; i < dataLength; i++) {

                var slide = document.createElement("div");
                slide.className = "col-sm-1";
                slide.classList.add("singleObject");

                var box = document.createElement("div");
                box.classList.add("objectImage");


                var img = document.createElement("img");
                img.classList.add("img-fluid");
                img.classList.add("img-thumbnail");
                img.classList.add(rBtnName)
                img.id = data[i]
                img.src = imagePath;
                img.alt = "alternative";
                img.addEventListener("click", function () {
                    document.getElementById("selected_model").innerHTML = this.id

                    elementImage = this.src;
                    n = elementImage.indexOf("static") - 1
                    totlen = elementImage.length
                    elImg = elementImage.substring(n, totlen)

                    if (elImg.includes("selected")) {
                        n = elImg.indexOf("_selected")
                        this.src = elImg.substring(0, n).concat(".png")

                        rbtnId = this.id.concat("rBtn");
                        rbtn = document.getElementById(rbtnId)
                        rbtn.checked = false;

                    } else {

                        $(".".concat(rBtnName)).each(function (i, obj) {
                            DisplayedImage = obj.src;
                            n = DisplayedImage.indexOf("static") - 1
                            totlen = DisplayedImage.length
                            pathImg = DisplayedImage.substring(n, totlen)

                            if (pathImg.includes("selected")) {
                                n = pathImg.indexOf("_selected")
                                obj.src = pathImg.substring(0, n).concat(".png")

                                rbtnId = obj.id.concat("rBtn");
                                rbtn = document.getElementById(rbtnId)
                                rbtn.checked = false;
                            }

                        })

                        n = elImg.length - 4
                        this.src = pathImg.substring(0, n).concat("_selected.png")
                        rbtnId = this.id.concat("rBtn");
                        rbtn = document.getElementById(rbtnId)
                        rbtn.checked = true;
                    }

                    gestoreContenutiExtra(rBtnName, rbtnId);

                });
                img.style.borderRadius = "50%";

                var radioBtn = document.createElement("input");
                radioBtn.type = "radio"
                radioBtn.value = data[i];
                radioBtn.id = data[i].concat("rBtn")
                radioBtn.style.visibility = "hidden";
                radioBtn.name = rBtnName

                var DataName = document.createElement("p");
                DataName.classList.add("job-title");
                DataName.innerHTML = data[i];

                slide.appendChild(box)
                box.appendChild(img)
                box.appendChild(DataName)
                box.appendChild(radioBtn)

                father.appendChild(slide);

            }
        }

        function gestoreContenutiExtra(nomi, id) {
            if (nomi == "model") {

                $(".".concat(nomi)).each(function () {

                    if (this.id == id.substring(0, id.length - 4)) {
                        toShow = model[this.id];
                        parametersDiv = document.getElementById("modelParameters")
                        parametersDiv.innerHTML = "<hr><h5>Set the Hyperparameters' Values</h5>"
                        parametersDiv.name = this.id + "pd"

                        if (document.getElementById(id).checked == true) {

                            for (const [key, value] of Object.entries(toShow)) {
                                modelNames.push(key)

                                divInput = document.createElement("div");
                                divInput.classList.add("form-group")

                                checkbox = document.createElement("input")
                                checkbox.setAttribute("type", "checkbox");
                                checkbox.id = key + "_check"
                                checkbox.name = "model." + key + "_check"
                                divInput.appendChild(checkbox)
                                $(document).off('change', '#'.concat(checkbox.id));
                                $(document).on('change', '#'.concat(checkbox.id), function () {

                                    mdl = parametersDiv.name.substring(0, parametersDiv.name.length - 2)
                                    param = model[mdl]
                                    param = param[this.id.substring(0, this.id.length - 6)]

                                    fat = this.parentElement
                                    check = this.cloneNode(true);
                                    fat.innerHTML = ""
                                    fat.appendChild(check)
                                    fat.appendChild(document.createTextNode("Optimize parameter"))

                                    if (this.checked == true) {
                                        switch (param["type"]) {
                                            case "Categorical":
                                                newInput = document.createElement("select")
                                                newInput.setAttribute("multiple", "");
                                                newInput.classList.add("coolSelect");
                                                newInput.name = "model." + key;
                                                newInput.id = key

                                                for (const val of param["possible_values"]) {
                                                    var option = document.createElement("option");
                                                    option.text = val;
                                                    newInput.appendChild(option)
                                                }

                                                var label = document.createElement("div");

                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                                else {newHTML += "<b>" + key + "</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;

                                                fat.appendChild(label);
                                                fat.appendChild(newInput);

                                                break;
                                            case "Real":
                                                row = document.createElement("div")
                                                row.classList.add("row")

                                                col1 = document.createElement("div")
                                                col1.classList.add("col-6")

                                                col2 = document.createElement("div")
                                                col2.classList.add("col-6")

                                                row.appendChild(col1)
                                                row.appendChild(col2)

                                                newInput = document.createElement("input")
                                                newInput.setAttribute("type", "number");
                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                    newInput.defaultValue = value["min_value"];

                                                } else {
                                                    newInput.setAttribute("step", "any");
                                                }
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.name = "model." + key + "_xminx";


                                                var label = document.createElement("div");
                                                label.htmlFor = "model." + key + "_xminx";
                                                label.style.padding = "5px";
                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + " from</b>";}
                                                else {newHTML += "<b>" + key + " from</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;

                                                col1.appendChild(label);
                                                col1.appendChild(newInput);

                                                newInput = document.createElement("input")

                                                newInput.setAttribute("type", "number");

                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                } else {
                                                    newInput.setAttribute("step", "any");
                                                }
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.defaultValue = value["max_value"];
                                                newInput.name = "model." + key + "_xmaxx";


                                                var label = document.createElement("div");
                                                label.htmlFor = "model." + key + "_xmaxx";
                                                label.style.padding = "5px";

                                                label.innerHTML = "<b>to</b>";

                                                col2.appendChild(label);
                                                col2.appendChild(newInput);

                                                fat.appendChild(row)
                                                break;

                                            case "Integer":
                                                row = document.createElement("div")
                                                row.classList.add("row")

                                                col1 = document.createElement("div")
                                                col1.classList.add("col-6")

                                                col2 = document.createElement("div")
                                                col2.classList.add("col-6")

                                                row.appendChild(col1)
                                                row.appendChild(col2)

                                                newInput = document.createElement("input")

                                                newInput.setAttribute("type", "number");
                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                }
                                                newInput.defaultValue = value["min_value"];
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.name = "model." + key + "_xminx";


                                                var label = document.createElement("div");
                                                label.htmlFor = "model." + key + "_xminx";
                                                label.style.padding = "5px";

                                                ////
                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + " from</b>";}
                                                else {newHTML += "<b>" + key + " from</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;

                                                col1.appendChild(label);
                                                col1.appendChild(newInput);

                                                newInput = document.createElement("input")
                                                newInput.setAttribute("type", "number");
                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                }
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.defaultValue = value["max_value"];
                                                newInput.name = "model." + key + "_xmaxx";


                                                var label = document.createElement("label");
                                                label.htmlFor = "model." + key + "_xmaxx";
                                                label.style.padding = "5px";
                                                label.innerHTML = "<b>to</b>";

                                                col2.appendChild(label);
                                                col2.appendChild(newInput);

                                                fat.appendChild(row)
                                                break;
                                        }
                                        $("#" + idd).popover({
                                            html: true,
                                            content: function(idd) {
                                              return $("#newDiv" + idd).html();
                                            }.bind(this, idd)
                                        });
                                    } else {
                                        switch (param["type"]) {
                                            case "Categorical":
                                                newInput = document.createElement("select")
                                                newInput.classList.add("coolSelect");
                                                newInput.name = "model." + key;
                                                newInput.id = key

                                                for (const val of param["possible_values"]) {
                                                    var option = document.createElement("option");
                                                    option.text = val;
                                                    newInput.appendChild(option)
                                                }

                                                var label = document.createElement("div");
                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                                else {newHTML += "<b>" + key + "</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;
                                                fat.appendChild(label);
                                                fat.appendChild(newInput);
                                                updateDropdownIndex(newInput.id, param["default_value"]);


                                                break;
                                            case "Real":
                                                newInput = document.createElement("input")

                                                newInput.setAttribute("type", "number");
                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                } else {
                                                    newInput.setAttribute("step", "any");
                                                }
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.name = "model." + key;
                                                newInput.id = key
                                                newInput.defaultValue = param["default_value"]

                                                var label = document.createElement("div");
                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                                else {newHTML += "<b>" + key + "</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;

                                                fat.appendChild(label);
                                                fat.appendChild(newInput);
                                                break;

                                            case "Integer":

                                                newInput = document.createElement("input")

                                                newInput.setAttribute("type", "number");
                                                if ("step" in value) {
                                                    newInput.setAttribute("step", value["step"]);
                                                }
                                                newInput.setAttribute("min", param["min_value"]);
                                                newInput.setAttribute("max", param["max_value"]);
                                                newInput.name = "model." + key;
                                                newInput.id = key
                                                newInput.defaultValue = param["default_value"]

                                                var label = document.createElement("div");
                                                var idd = "param_" + key
                                                var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                                if ('description' in value){
                                                    newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                                }
                                                else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                                if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + " from</b>";}
                                                else {newHTML += "<b>" + key + " from</b>";}
                                                newHTML += "</p>"

                                                label.innerHTML = newHTML;

                                                fat.appendChild(label);
                                                fat.appendChild(newInput);

                                                break;

                                        }
                                        $("#" + idd).popover({
                                            html: true,
                                            content: function(idd) {
                                              return $("#newDiv" + idd).html();
                                            }.bind(this, idd)
                                        });
                                    }
                                });
                                divInput.appendChild(document.createTextNode("Optimize parameter"));
                                parametersDiv.appendChild(divInput);

                                switch (value["type"]) {
                                    case "Categorical":
                                        newInput = document.createElement("select")
                                        newInput.classList.add("coolSelect");
                                        newInput.name = "model." + key;
                                        newInput.id = key

                                        for (const val of value["possible_values"]) {
                                            var option = document.createElement("option");
                                            option.text = val;
                                            newInput.appendChild(option)
                                        }

                                        var label = document.createElement("div");
                                        var idd = "param_" + key
                                        var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                        if ('description' in value){
                                            newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                        }
                                        else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                        if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                        else {newHTML += "<b>" + key + "</b>";}
                                        newHTML += "</p>"

                                        label.innerHTML = newHTML;

                                        divInput.appendChild(label);
                                        divInput.appendChild(newInput);
                                        updateDropdownIndex(newInput.id, value["default_value"]);

                                        break;
                                    case "Real":
                                        newInput = document.createElement("input")

                                        newInput.setAttribute("type", "number");
                                        if ("step" in value) {
                                            newInput.setAttribute("step", value["step"]);
                                        } else {
                                            newInput.setAttribute("step", "any");
                                        }
                                        newInput.setAttribute("min", value["min_value"]);
                                        newInput.setAttribute("max", value["max_value"]);
                                        newInput.name = "model." + key;
                                        newInput.id = key
                                        newInput.defaultValue = value["default_value"]

                                        var label = document.createElement("div");

                                        var idd = "param_" + key
                                        var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                        if ('description' in value){
                                            newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                        }
                                        else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                        if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                        else {newHTML += "<b>" + key + "</b>";}
                                        newHTML += "</p>"

                                        label.innerHTML = newHTML;

                                        divInput.appendChild(label);
                                        divInput.appendChild(newInput);
                                        break;

                                    case "Integer":

                                        newInput = document.createElement("input")

                                        newInput.setAttribute("type", "number");
                                        if ("step" in value) {
                                            newInput.setAttribute("step", value["step"]);
                                        }
                                        newInput.setAttribute("min", value["min_value"]);
                                        newInput.setAttribute("max", value["max_value"]);
                                        newInput.name = "model." + key;
                                        newInput.id = key
                                        newInput.defaultValue = value["default_value"]

                                        var label = document.createElement("div");

                                        var idd = "param_" + key
                                        var newHTML = "<div style='display:none' id ='newDiv" + idd + "'>";
                                        if ('description' in value){
                                            newHTML += "</div><p data-toggle=\"popover\" tabindex=\"-1\" data-trigger=\"focus\" id=\"" + idd + "\" data-content=\"" + value["description"] + "\" data-original-title=\"Hyperparameter description\" data-html=\"true\" data-placement=\"bottom\" aria-label=\"Left Align\">";
                                        }
                                        else{newHTML += "</div><p id=\"" + idd + "\" data-html=\"true\">";}

                                        if ("alternative_name" in value){newHTML += "<b>" + value["alternative_name"] + "</b>";}
                                        else {newHTML += "<b>" + key + "</b>";}
                                        newHTML += "</p>"

                                        label.innerHTML = newHTML;

                                        divInput.appendChild(label);
                                        divInput.appendChild(newInput);

                                        break;
                                }
                                 $("#" + idd).popover({
                                            html: true,
                                            content: function(idd) {
                                              return $("#newDiv" + idd).html();
                                            }.bind(this, idd)
                                        });
                            }
                        }
                    }
                });
            }
        }
        function updateDropdownIndex(dropdownId, value) {
            dropDown = document.getElementById(dropdownId)
            for (var i, j = 0; i = dropDown.options[j]; j++) {
                if (i.value == value) {
                    dropDown.selectedIndex = j;
                    break;
                }
            }
        }
        });


    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
</body>

</html>
